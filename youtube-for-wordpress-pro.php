<?php
/**
 * Plugin Name: YouTube for WordPress Pro
 * Plugin URI: https://jameswelbes.com/youtube-for-wordpress
 * Description: Adds Pro features to YouTube for WordPress.
 * Version: 1.0.0
 * Requires at least: 5.8
 * Requires PHP: 7.4
 * Author: James Welbes
 * Author URI: https://jameswelbes.com
 * Text Domain: yt-for-wp-pro
 * Domain Path: /languages
 * License: GPL v2 or later
 * License URI: http://www.gnu.org/licenses/gpl-2.0.txt
 */

namespace YouTubeForWPPro;

// Exit if accessed directly.
if (!defined('ABSPATH')) {
    exit;
}

// Define plugin constants.
define('YOUTUBE_FOR_WP_PRO_VERSION', '1.0.0');
define('YT_FOR_WP_PRO_PATH', plugin_dir_path(__FILE__));
define('YT_FOR_WP_PRO_URL', plugin_dir_url(__FILE__));

// Include plugin.php for is_plugin_active().
if (!function_exists('is_plugin_active')) {
    require_once ABSPATH . 'wp-admin/includes/plugin.php';
}

/**
 * Check if the free version is active.
 *
 * @return bool
 */
function is_free_version_active() {
    return is_plugin_active('youtube-for-wordpress/youtube-for-wordpress.php');
}

/**
 * Check dependencies on activation.
 */
function activation_check() {
    if (!is_free_version_active()) {
        deactivate_plugins(plugin_basename(__FILE__));
        wp_die(
            esc_html__(
                'YouTube for WordPress Pro requires the free version of YouTube for WordPress to be installed and active.',
                'yt-for-wp-pro'
            ),
            esc_html__('Plugin Dependency Error', 'yt-for-wp-pro'),
            ['back_link' => true]
        );
    }
}
register_activation_hook(__FILE__, __NAMESPACE__ . '\\activation_check');

/**
 * Load Pro functionality if the free version is active.
 */
function load_pro_plugin() {
    if (!is_free_version_active()) {
        return;
    }

    // Include required files for Pro functionality.
    require_once YT_FOR_WP_PRO_PATH . 'includes/pro-features.php';

    // Initialize Pro features.
    add_action('plugins_loaded', function () {
        do_action('yt_for_wp_pro_loaded');
    });
}
add_action('plugins_loaded', __NAMESPACE__ . '\\load_pro_plugin');

add_action('enqueue_block_editor_assets', function () {
    // Include the asset file generated by the build process
    $asset_file = include plugin_dir_path(__FILE__) . 'build/index.asset.php';

    wp_enqueue_script(
        'yt-for-wp-pro-block-editor',
        plugins_url('build/index.js', __FILE__), // Single bundled file
        $asset_file['dependencies'], // Properly extracted dependencies
        $asset_file['version'],      // Properly extracted version
        true
    );
});

add_action('wp_enqueue_scripts', function () {
    // Include the asset file generated by the build process
    $asset_file = include plugin_dir_path(__FILE__) . 'build/index.asset.php';

    wp_enqueue_script(
        'yt-for-wp-pro-view',
        plugins_url('build/index.js', __FILE__), // Same bundled file
        $asset_file['dependencies'], // Properly extracted dependencies
        $asset_file['version'],      // Properly extracted version
        true
    );
});



